# ğŸ“Š Diagrama de Flujo de Datos - Workflow OTP

Este diagrama muestra cÃ³mo fluyen los datos por cada nodo del workflow.

---

## ğŸ”„ Flujo Completo con Datos Mock

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ENTRADA: POST Request desde Next.js                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  POST http://localhost:5678/webhook/zecubot-send-otp                â”‚
â”‚                                                                       â”‚
â”‚  Headers:                                                            â”‚
â”‚    Content-Type: application/json                                    â”‚
â”‚                                                                       â”‚
â”‚  Body:                                                               â”‚
â”‚    {                                                                 â”‚
â”‚      "phone": "+5491134070204",                                      â”‚
â”‚      "code": "123456",                                               â”‚
â”‚      "name": "TomÃ¡s Jones"                                           â”‚
â”‚    }                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¥ NODO 1: Webhook Recibir OTP                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Tipo: Trigger (n8n-nodes-base.webhook)                             â”‚
â”‚  AcciÃ³n: Recibe el POST request y extrae los datos                  â”‚
â”‚                                                                       â”‚
â”‚  Output:                                                             â”‚
â”‚    {                                                                 â”‚
â”‚      "headers": {                                                    â”‚
â”‚        "content-type": "application/json",                           â”‚
â”‚        "user-agent": "...",                                          â”‚
â”‚        ...                                                           â”‚
â”‚      },                                                              â”‚
â”‚      "body": {                                                       â”‚
â”‚        "phone": "+5491134070204",                                    â”‚
â”‚        "code": "123456",                                             â”‚
â”‚        "name": "TomÃ¡s Jones"                                         â”‚
â”‚      }                                                               â”‚
â”‚    }                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… NODO 2: Validar Datos                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Tipo: Condicional (n8n-nodes-base.if)                              â”‚
â”‚  AcciÃ³n: Valida que phone y code no estÃ©n vacÃ­os                    â”‚
â”‚                                                                       â”‚
â”‚  CondiciÃ³n 1: $json.body.phone is not empty                         â”‚
â”‚  CondiciÃ³n 2: $json.body.code is not empty                          â”‚
â”‚                                                                       â”‚
â”‚  Output (TRUE):  â†’ Va a "Preparar Mensaje"                          â”‚
â”‚  Output (FALSE): â†’ Va a "Respuesta Error (ValidaciÃ³n)"              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                            TRUE
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ NODO 3: Preparar Mensaje                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Tipo: Set (n8n-nodes-base.set)                                     â”‚
â”‚  AcciÃ³n: Extrae datos del body y formatea el mensaje de WhatsApp    â”‚
â”‚                                                                       â”‚
â”‚  Valores que crea:                                                   â”‚
â”‚    - phone:   {{ $json.body.phone }}                                â”‚
â”‚    - code:    {{ $json.body.code }}                                 â”‚
â”‚    - name:    {{ $json.body.name || 'Usuario' }}                    â”‚
â”‚    - message: "Hola {{ name }}! ğŸ‘‹\n\n..."                          â”‚
â”‚                                                                       â”‚
â”‚  Output:                                                             â”‚
â”‚    {                                                                 â”‚
â”‚      "phone": "+5491134070204",                                      â”‚
â”‚      "code": "123456",                                               â”‚
â”‚      "name": "TomÃ¡s Jones",                                          â”‚
â”‚      "message": "Hola TomÃ¡s Jones! ğŸ‘‹\n\n                           â”‚
â”‚                  Tu cÃ³digo de verificaciÃ³n Zecubot es:\n\n          â”‚
â”‚                  *123456*\n\n                                        â”‚
â”‚                  Este cÃ³digo expira en 5 minutos.\n\n               â”‚
â”‚                  ğŸ”’ Nunca compartas este cÃ³digo con nadie."          â”‚
â”‚    }                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“± NODO 4: Enviar WhatsApp (Twilio)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Tipo: Twilio (n8n-nodes-base.twilio)                               â”‚
â”‚  AcciÃ³n: EnvÃ­a el mensaje por WhatsApp usando la API de Twilio      â”‚
â”‚                                                                       â”‚
â”‚  ConfiguraciÃ³n:                                                      â”‚
â”‚    - From: whatsapp:+12692562013  (tu nÃºmero de Twilio)             â”‚
â”‚    - To:   whatsapp:+5491134070204 (del input)                      â”‚
â”‚    - Body: {{ $json.message }}                                      â”‚
â”‚                                                                       â”‚
â”‚  Request a Twilio API:                                               â”‚
â”‚    POST https://api.twilio.com/2010-04-01/Accounts/{SID}/Messages   â”‚
â”‚    Body: {                                                           â”‚
â”‚      "From": "whatsapp:+12692562013",                                â”‚
â”‚      "To": "whatsapp:+5491134070204",                                â”‚
â”‚      "Body": "Hola TomÃ¡s Jones! ğŸ‘‹\n\n..."                          â”‚
â”‚    }                                                                 â”‚
â”‚                                                                       â”‚
â”‚  Output (si exitoso):                                                â”‚
â”‚    {                                                                 â”‚
â”‚      "sid": "SM1234567890abcdef1234567890abcdef",                    â”‚
â”‚      "status": "queued",                                             â”‚
â”‚      "to": "whatsapp:+5491134070204",                                â”‚
â”‚      "from": "whatsapp:+12692562013",                                â”‚
â”‚      "body": "Hola TomÃ¡s Jones! ğŸ‘‹\n\n...",                         â”‚
â”‚      "num_segments": "1",                                            â”‚
â”‚      "price": null,                                                  â”‚
â”‚      "price_unit": "USD"                                             â”‚
â”‚    }                                                                 â”‚
â”‚                                                                       â”‚
â”‚  Output (si falla): â†’ Maneja error en "Respuesta Error (Twilio)"    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ”ï¸ NODO 5: Respuesta Ã‰xito                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Tipo: Respond to Webhook (n8n-nodes-base.respondToWebhook)         â”‚
â”‚  AcciÃ³n: EnvÃ­a respuesta exitosa a Next.js                          â”‚
â”‚                                                                       â”‚
â”‚  HTTP Status: 200 OK                                                 â”‚
â”‚                                                                       â”‚
â”‚  Response Body:                                                      â”‚
â”‚    {                                                                 â”‚
â”‚      "success": true,                                                â”‚
â”‚      "message": "OTP enviado correctamente a +5491134070204",        â”‚
â”‚      "timestamp": "2024-10-21T15:30:45.123Z"                         â”‚
â”‚    }                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¨ RESULTADO: Next.js recibe la respuesta                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  El cÃ³digo en zecu/app/api/auth/send-otp/route.ts procesa:          â”‚
â”‚                                                                       â”‚
â”‚  if (result.success) {                                               â”‚
â”‚    console.log('âœ… OTP enviado por WhatsApp correctamente')          â”‚
â”‚  }                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”€ Flujo Alternativo: ValidaciÃ³n Falla

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ENTRADA: Datos InvÃ¡lidos                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Body:                                                               â”‚
â”‚    {                                                                 â”‚
â”‚      "phone": "",                                                    â”‚
â”‚      "code": ""                                                      â”‚
â”‚    }                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
            ğŸ“¥ Webhook Recibir OTP
                              â†“
              âœ… Validar Datos
                              â†“
                           FALSE
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âŒ NODO 6: Respuesta Error (ValidaciÃ³n)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Tipo: Respond to Webhook (n8n-nodes-base.respondToWebhook)         â”‚
â”‚  AcciÃ³n: EnvÃ­a error de validaciÃ³n a Next.js                        â”‚
â”‚                                                                       â”‚
â”‚  HTTP Status: 400 Bad Request                                        â”‚
â”‚                                                                       â”‚
â”‚  Response Body:                                                      â”‚
â”‚    {                                                                 â”‚
â”‚      "success": false,                                               â”‚
â”‚      "error": "Datos incompletos. Se requiere phone y code",         â”‚
â”‚      "timestamp": "2024-10-21T15:30:45.123Z"                         â”‚
â”‚    }                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”€ Flujo Alternativo: Twilio Falla

```
            ğŸ“¥ Webhook Recibir OTP
                              â†“
              âœ… Validar Datos (OK)
                              â†“
            ğŸ“ Preparar Mensaje (OK)
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“± Enviar WhatsApp (Twilio) - FALLA                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Posibles errores:                                                   â”‚
â”‚    - Credenciales incorrectas                                        â”‚
â”‚    - NÃºmero no vÃ¡lido                                                â”‚
â”‚    - Sin saldo                                                       â”‚
â”‚    - NÃºmero no verificado (Twilio Trial)                             â”‚
â”‚                                                                       â”‚
â”‚  Error Output:                                                       â”‚
â”‚    {                                                                 â”‚
â”‚      "error": "The 'To' number is not a valid phone number",         â”‚
â”‚      "code": 21211                                                   â”‚
â”‚    }                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸ NODO 7: Respuesta Error (Twilio)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Tipo: Respond to Webhook (n8n-nodes-base.respondToWebhook)         â”‚
â”‚  AcciÃ³n: EnvÃ­a error de Twilio a Next.js                            â”‚
â”‚                                                                       â”‚
â”‚  HTTP Status: 500 Internal Server Error                              â”‚
â”‚                                                                       â”‚
â”‚  Response Body:                                                      â”‚
â”‚    {                                                                 â”‚
â”‚      "success": false,                                               â”‚
â”‚      "error": "Error al enviar WhatsApp: The 'To' number...",        â”‚
â”‚      "timestamp": "2024-10-21T15:30:45.123Z"                         â”‚
â”‚    }                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Tabla Resumen de Datos por Nodo

| Nodo                          | Input Clave                     | Output Clave                    | Siguiente Nodo           |
|-------------------------------|---------------------------------|---------------------------------|--------------------------|
| 1. Webhook Recibir OTP        | `body: { phone, code, name }`   | `body.phone`, `body.code`       | Validar Datos            |
| 2. Validar Datos              | `body.phone`, `body.code`       | TRUE/FALSE                      | Preparar / Error         |
| 3. Preparar Mensaje           | `body.*`                        | `phone`, `code`, `message`      | Enviar WhatsApp          |
| 4. Enviar WhatsApp (Twilio)   | `phone`, `message`              | `sid`, `status`                 | Respuesta Ã‰xito          |
| 5. Respuesta Ã‰xito            | `phone` (del paso 3)            | `{ success: true, ... }`        | FIN (200)                |
| 6. Respuesta Error (Valid.)   | -                               | `{ success: false, ... }`       | FIN (400)                |
| 7. Respuesta Error (Twilio)   | `error` (de Twilio)             | `{ success: false, ... }`       | FIN (500)                |

---

## ğŸ¨ Vista Simplificada

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Next.js   â”‚
                    â”‚   POST     â”‚
                    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   ğŸ”” Webhook          â”‚
              â”‚   Recibir OTP         â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   âœ… Validar          â”‚
              â”‚   phone & code        â”‚
              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚        â”‚
                 âœ“ OK         âœ— Error
                     â”‚        â”‚
                     â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â†“                       â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   ğŸ“ Preparar    â”‚    â”‚   âŒ Error 400   â”‚
          â”‚   Mensaje        â”‚    â”‚   ValidaciÃ³n     â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   ğŸ“± Twilio      â”‚
          â”‚   Enviar WA      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
            â”‚             â”‚
        âœ“ OK           âœ— Error
            â”‚             â”‚
            â†“             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ âœ”ï¸ Success   â”‚  â”‚ âš ï¸ Error 500 â”‚
    â”‚ 200          â”‚  â”‚ Twilio       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¡ CÃ³mo Usar Este Diagrama

1. **Para entender el flujo:** Lee de arriba hacia abajo
2. **Para debuggear:** Identifica en quÃ© nodo falla y revisa su "Output Esperado"
3. **Para probar:** Usa los datos mock del input y verifica cada output
4. **Para modificar:** Cambia el nodo "Preparar Mensaje" para personalizar el texto

---

## ğŸ” Ver Estos Datos en n8n

1. Ejecuta el workflow en modo test
2. Haz clic en cada nodo
3. En el panel derecho verÃ¡s **"Input"** y **"Output"**
4. Compara con este diagrama para verificar que todo estÃ© correcto

---

**Â¡Este diagrama es tu mapa para entender y debuggear el workflow! ğŸ—ºï¸**

